From cdcad764c01084d435c17e6a57450ca4a066705c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@gmail.com>
Date: Wed, 3 Apr 2019 20:50:18 +0200
Subject: [PATCH] Fix build for linux/musl
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Musl (and myabe other libc libraries) does not have execinfo.h. So instead
of assuming the header existant for all linux environments check for the file.

Upstream-Status: Applied [1]

[1] https://github.com/csound/csound/commit/7f93585037a41fbff22ce49d3bbde0d66eb7530b

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@gmail.com>
---
 CMakeLists.txt | 5 ++++-
 Top/csound.c   | 2 +-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index d5a8e1bed..90bca5950 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -603,7 +603,7 @@ set(HEADERS_TO_CHECK
     unistd.h io.h fcntl.h stdint.h
     sys/time.h sys/types.h termios.h
     values.h winsock.h sys/socket.h
-    dirent.h inttypes.h)
+    dirent.h inttypes.h execinfo.h)
 
 foreach(header ${HEADERS_TO_CHECK})
     # Convert to uppercase and replace [./] with _
@@ -617,6 +617,9 @@ if (NOT HAVE_INTTYPES_H)
     message(FATAL_ERROR "Csound requires inttypes.h")
 endif()
 
+if (HAVE_EXECINFO_H)
+    add_definitions("-DHAVE_EXECINFO")
+endif()
 
 check_deps(USE_LRINT HAVE_LRINT)
 if(USE_LRINT)
diff --git a/Top/csound.c b/Top/csound.c
index 9b95674df..48a53717a 100644
--- a/Top/csound.c
+++ b/Top/csound.c
@@ -1157,7 +1157,7 @@ static void psignal_(int sig, char *str)
 
 static void signal_handler(int sig)
 {
-#if defined(LINUX) && !defined(ANDROID) && !defined(NACL)
+#if defined(HAVE_EXECINFO) && !defined(ANDROID) && !defined(NACL)
     #include <execinfo.h>
 
     {
-- 
2.20.1

