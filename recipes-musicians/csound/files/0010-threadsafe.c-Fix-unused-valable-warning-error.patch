From d91048c4943e81dafcdb2db701fe04c0a9d6e0b1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@gmail.com>
Date: Wed, 3 Apr 2019 21:01:24 +0200
Subject: [PATCH] threadsafe.c: Fix unused valable warning/error
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

| Top/threadsafe.c:537:5: error: variable 'x' set but not used [-Werror=unused-but-set-variable]
|    } x;
|      ^
| cc1: all warnings being treated as errors

Upstream-Status: Applied [1]

[1] https://github.com/csound/csound/commit/0c7fee69278933a3eb108d17a641ab4ecabde7c6

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@gmail.com>
---
 Top/threadsafe.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/Top/threadsafe.c b/Top/threadsafe.c
index 3a7278459..6214a1b5e 100644
--- a/Top/threadsafe.c
+++ b/Top/threadsafe.c
@@ -531,11 +531,13 @@ MYFLT csoundGetControlChannel(CSOUND *csound, const char *name, int *err)
 
 void csoundSetControlChannel(CSOUND *csound, const char *name, MYFLT val){
   MYFLT *pval;
+#if defined(MSVC) || defined(HAVE_ATOMIC_BUILTIN)
   union {
     MYFLT d;
     MYFLT_INT_TYPE i;
   } x;
   x.d = val;
+#endif
   if (csoundGetChannelPtr(csound, &pval, name,
                           CSOUND_CONTROL_CHANNEL | CSOUND_INPUT_CHANNEL)
       == CSOUND_SUCCESS)
-- 
2.20.1

