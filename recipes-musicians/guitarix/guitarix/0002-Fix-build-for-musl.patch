From 2e98159fe860cb42458fa3b434fe0eacda5e4b97 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@gmail.com>
Date: Sun, 7 Apr 2019 20:56:49 +0200
Subject: [PATCH] Fix build for musl
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The function mallopt and it's constants doe not seem to be defined by POSIX so
musl does not define them. Get around by check for constants.

Upstream-Status: Applied [1]

[1] https://sourceforge.net/p/guitarix/git/ci/8ec1f3088e914e87cf2c04764b24e2bd5cafc940/

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@gmail.com>
---
 src/gx_head/gui/machine.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/gx_head/gui/machine.cpp b/src/gx_head/gui/machine.cpp
index bdc137d..d912839 100644
--- a/src/gx_head/gui/machine.cpp
+++ b/src/gx_head/gui/machine.cpp
@@ -35,8 +35,10 @@
 void set_memory_allocation() {
     if (mlockall(MCL_CURRENT | MCL_FUTURE))
         gx_print_error("system init", "mlockall failed:");
+#if defined(M_TRIM_THRESHOLD) && defined(M_MMAP_MAX)
     mallopt(M_TRIM_THRESHOLD, -1);
     mallopt(M_MMAP_MAX, 0);
+#endif
 }
 
 #else
-- 
2.20.1

