From 58d45693b42953c6d85d3d1dcf665796bb6db084 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@gmail.com>
Date: Sat, 27 Apr 2019 23:02:21 +0200
Subject: [PATCH] Fix fonts for locales as 'en_US.utf8'
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This should fix [1]

[1] https://github.com/sadko4u/lsp-plugins/issues/17#issuecomment-487228134

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@gmail.com>
---
 src/core/io/charset.cpp | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/core/io/charset.cpp b/src/core/io/charset.cpp
index 4ff9c7f9..c044b18d 100644
--- a/src/core/io/charset.cpp
+++ b/src/core/io/charset.cpp
@@ -517,7 +517,16 @@ namespace lsp
             // Get system locale
             current = setlocale(LC_CTYPE, "");
             if (current != NULL)
+            {
                 current = strchr(current, '.');
+                if (current != NULL)
+                {
+                    // For locale e.g 'en_US.utf8' iconv won't understand '.utf8'
+                    if((!strcmp(current, ".utf8")) || (!strcmp(current, ".UTF8")))
+                        // UTF-8 is default anyway - see below
+                        current = NULL;
+                }
+            }
 
             // Scan for character set
             if (current != NULL)
-- 
2.20.1

