From 81cf94ea9300b1093b552f69d2eb43f02f80274d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@gmail.com>
Date: Fri, 12 Apr 2019 23:24:52 +0200
Subject: [PATCH] Fix crash with mxml V3
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Loading my old qtractor-sessions started to crash on my Raspi. A remote debug
session lead to zynaddsubfx and the point of code.

Wih this modification the sessions load again without issues.

Upstream-Status: Submitted [1]

[1] https://github.com/zynaddsubfx/zynaddsubfx/pull/27

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@gmail.com>
---
 src/Misc/XMLwrapper.cpp | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/Misc/XMLwrapper.cpp b/src/Misc/XMLwrapper.cpp
index 64c7fd6d..b4bd2325 100644
--- a/src/Misc/XMLwrapper.cpp
+++ b/src/Misc/XMLwrapper.cpp
@@ -688,8 +688,11 @@ std::vector<XmlNode> XMLwrapper::getBranch(void) const
             XmlNode n(mxmlGetElement(current));
             int count = mxmlElementGetAttrCount(current);
             const char *name;
+            const char *attrib;
             for(int i = 0; i < count; ++i) {
-                n[name] = mxmlElementGetAttrByIndex(current, i, &name);
+                attrib = mxmlElementGetAttrByIndex(current, i, &name);
+                if(name)
+                    n[name] = attrib;
             }
 #else
             auto elm = current->value.element;
-- 
2.20.1

